---
export interface Props {
  id: string;
  title: string;
  contentId: string;
}

const { title, id, contentId } = Astro.props;
---

<content-section id={id} data-nimvio-content-id={contentId} data-contentid={contentId}>
  <section class="flex scroll-mt-24 flex-col items-center gap-4 space-y-8">
    <div class="flex flex-col items-center gap-4">
      <slot name="eyebrow" />
      <h2
        class="gradient-text text-center font-extrabold tracking-tight text-6xl"
      >
        {title}
      </h2>
    </div>
    <slot name="lead" />
    <slot />
  </section>
</content-section>

<script>
  import WebLink from "@nimvio/live-preview-sdk";
  import type { LivePreviewData } from "~/types";

  class ContentSection extends HTMLElement {
    constructor() {
      super();

      const nimvioSdk = WebLink.init({
        queryParam: "preview",
        disableWeblink: false,
      });

      // Read the contentid from the data attribute.
      const contentId = this.dataset.contentid;

      nimvioSdk.livePreviewUtils.onPreviewContentChange((newData) => {
        const { id, formData }: LivePreviewData = newData;
        console.log(formData, id, contentId, id === contentId);
        // if (id === contentId) {
        //   const elGithub = document.querySelector("#githubUrl");
        //   elGithub!.setAttribute("href", githubUrl);
        //   const elSplashText = document.querySelector("#splashText");
        //   elSplashText!.innerHTML = splashText;
        //   const elSplashLogo = document.querySelector("#splashLogo");
        //   elSplashLogo!.setAttribute("src", splashLogo.MediaUrl);
        //   const elSplashImage = document.querySelector("#splashImage");
        //   elSplashImage!.setAttribute("src", splashImage.MediaUrl);
        // }
      });

    }
  }

  customElements.define("content-section", ContentSection);
</script>
